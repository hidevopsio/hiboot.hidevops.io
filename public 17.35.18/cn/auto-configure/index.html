<!DOCTYPE html>
  
  
  
  
   
  <html class="no-js" lang="cn"> 
  

  <head lang="cn">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>自动配置 - Hiboot云原生应用框架</title>
    <meta name="generator" content="Hugo 0.59.1" />

    
    <meta name="description" content="Official site hidevops.io">
    
    <link rel="canonical" href="https://hiboot.hidevops.io/cn/auto-configure/">
    
    <meta name="author" content="John Deng">
    

    <meta property="og:url" content="https://hiboot.hidevops.io/cn/auto-configure/">
    <meta property="og:title" content="Hiboot云原生应用框架">
    <meta property="og:image" content="https://hiboot.hidevops.io/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Hiboot云原生应用框架">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://hiboot.hidevops.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://hiboot.hidevops.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://hiboot.hidevops.io/fonts/icon.eot');
        src: url('https://hiboot.hidevops.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://hiboot.hidevops.io/fonts/icon.woff')
               format('woff'),
             url('https://hiboot.hidevops.io/fonts/icon.ttf')
               format('truetype'),
             url('https://hiboot.hidevops.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://hiboot.hidevops.io/stylesheets/application.css">
    <link rel="stylesheet" href="https://hiboot.hidevops.io/stylesheets/_animation.css">
    <link rel="stylesheet" href="https://hiboot.hidevops.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://hiboot.hidevops.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://hiboot.hidevops.io/icons/style.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://hiboot.hidevops.io/javascripts/modernizr.js"></script>
    <script src="https://hiboot.hidevops.io/javascripts/growingio.js"></script>

    

  </head>
  <body class="palette-primary-cyan palette-accent-deep-purple">
    

<div class="backdrop">
    <div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
    <nav aria-label="Header">
    <div class="bar default zindex11">
        <div class="button button-menu" role="button" aria-label="Menu">
            <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
        </div>
        <div class="stretch">
            <div class="title">
                自动配置
            </div>
        </div>

        <div class="button button-home" role="button" aria-label="Home">
            <a href="https://hidevops.io" title="Home" target="_blank"  class="toggle-button icon icons-home"></a>
        </div>
        <div class="button button-twitter language_btn" role="button" aria-label="Twitter">
            <a href="javascript:;" title="Switch languages" class="toggle-button icons-globe"></a>
            <div class="layer_box">
                
                  
                
                  
                  <a href="https://hiboot.hidevops.io/en" lang="en">English</a>
                  
                
            </div>
        </div>
        
        <div class="button button-twitter" role="button" aria-label="Twitter">
            <a href="https://twitter.com/johndcn" title="@johndcn on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
        </div>
         
        <div class="button button-github" role="button" aria-label="GitHub">
            <a href="https://github.com/hidevopsio" title="@hidevopsio on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
        </div>
        

        <div class="button button-search" role="button" aria-label="Search">
            <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
        </div>
    </div>
    <div class="bar search">
        <div class="button button-close" role="button" aria-label="Close">
            <label class="toggle-button icon icon-back" for="toggle-search"></label>
        </div>
        <div class="stretch">
            <div class="field">
                <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
            </div>
        </div>
        <div class="button button-reset" role="button" aria-label="Search">
            <button class="toggle-button icon icon-close" id="reset-search"></button>
        </div>
    </div>
</nav>
</header>

<main class="main">
    <div class="drawer">
        <nav aria-label="Navigation">
    <a href="https://hiboot.hidevops.io/cn" class="project">
        <div class="banner">
            
            <div class="logo">
                <img src="https://hiboot.hidevops.io/images/logo.png">
            </div>
            
            <div class="name">
                <strong>Hiboot云原生应用框架 <span class="version">v1.2.1</span></strong> 
                <br> 
            </div>
        </div>
    </a>

    <div class="scrollable">
        <div class="wrapper">
            
            <ul class="repo">
                <li class="repo-download">
                    <a href="//archive/master.zip" target="_blank" title="Download" data-action="download">
                        <i class="icon icon-download"></i> Download
                    </a>
                </li>
                <li class="repo-stars">
                    <a href="//stargazers" target="_blank" title="Stargazers" data-action="star">
                        <i class="icon icon-star"></i> Stars
                        <span class="count">&ndash;</span>
                    </a>
                </li>
            </ul>
            <hr> 

            <div class="toc">
                
                <ul>
                    
<nav role="navigation">
  <ul class="list pa0 nl2">
    
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2  primary-parent-color" data-target=".Hiboot云原生应用框架">Hiboot云原生应用框架</a>
        <ul class="Hiboot云原生应用框架 desktopmenu animated fadeIn list pl0 bg-light-gray db">
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/getting-started/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              入门
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/cli-app/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              命令行应用
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/web-app/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              网络应用
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/auto-configure/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 primary-color ">
              自动配置
            </a>
          </li>
        </ul>
      </li>
  </ul>
</nav>

                </ul>
                 
                <hr>
                <span class="section">The author</span>

                <ul>
                    
                    <li>
                        <a href="https://twitter.com/johndcn" target="_blank" title="@johndcn on Twitter">
              @johndcn on Twitter
            </a>
                    </li>
                     
                    <li>
                        <a href="https://github.com/hidevopsio" target="_blank" title="@hidevopsio on GitHub">
              @hidevopsio on GitHub
            </a>
                    </li>
                     
                    <li>
                        <a href="mailto:hi.devops.io@gmail.com" title="Email of hi.devops.io@gmail.com">
              Contact via email
            </a>
                    </li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</nav>
    </div>
    <article class="article">
        <div class="wrapper">
            <div class="contentWrapper">
                <h1>自动配置 </h1>
                

<h2 id="自动配置-starter">自动配置 Starter</h2>

<p>Hiboot auto-configuration attempts to automatically configure your Hiboot application based on the pkg dependencies that you have added.
For example, if bolt is imported in you main.go, and you have not manually configured any database connection,
then Hiboot auto-configures an database bolt for any service to inject.</p>

<p>You need to opt-in to auto-configuration by embedding app.Configuration in your configuration and
calling the app.Register() function inside the init() function of your configuration pkg.</p>

<p>For more details, see <a href="https://godoc.org/hidevops.io/hiboot/pkg/starter">https://godoc.org/hidevops.io/hiboot/pkg/starter</a></p>

<h2 id="创建你自己的-starter">创建你自己的 Starter</h2>

<p>A full Hiboot starter for a library may contain the following structs:
    autoconfigure - object that handle the auto-configuration code.
    properties - object that contains properties which will be injected configurable default values or user specified values
If you work in a company that develops shared go packages, or if you work on an open-source or commercial project,
you might want to develop your own auto-configured starter. starter can be implemented in external packages and
can be imported by any go applications.</p>

<p>Understanding Auto-configured Starter</p>

<p>Under the hood, auto-configuration is implemented with standard struct. Additional embedded field app.Configuration.
AutoConfiguration used to constrain when the auto-configuration should apply. Usually, auto-configuration struct use
<code>after:&quot;fooConfiguration&quot;</code> or <code>missing:&quot;fooConfiguration&quot;</code> tags. This ensures that auto-configuration applies only
when relevant configuration are found and when you have not declared your own configuration.</p>

<h2 id="代码示例">代码示例</h2>

<p>This example shows the guide to make customized auto configuration
for more details, see <a href="https://hidevops.io/hiboot-data/blob/master/starter/bolt/autoconfigure.go">https://hidevops.io/hiboot-data/blob/master/starter/bolt/autoconfigure.go</a></p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">bolt</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;hidevops.io/hiboot/pkg/app&#34;</span>
	<span class="s">&#34;os&#34;</span>
<span class="p">)</span>

<span class="c1">// properties
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">properties</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Database</span> <span class="kt">string</span>      <span class="s">`json:&#34;database&#34; default:&#34;hiboot.db&#34;`</span>
	<span class="nx">Mode</span>     <span class="nx">os</span><span class="p">.</span><span class="nx">FileMode</span> <span class="s">`json:&#34;mode&#34; default:&#34;0600&#34;`</span>
	<span class="nx">Timeout</span>  <span class="kt">int64</span>       <span class="s">`json:&#34;timeout&#34; default:&#34;2&#34;`</span>
<span class="p">}</span>

<span class="c1">// declare boltConfiguration
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">boltConfiguration</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">Configuration</span>
	<span class="c1">// the properties member name must be Bolt if the mapstructure is bolt,
</span><span class="c1"></span>	<span class="c1">// so that the reference can be parsed
</span><span class="c1"></span>	<span class="nx">BoltProperties</span> <span class="nx">properties</span> <span class="s">`mapstructure:&#34;bolt&#34;`</span>
<span class="p">}</span>

<span class="c1">// BoltRepository
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">BoltRepository</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// register newBoltConfiguration as AutoConfiguration
</span><span class="c1"></span>	<span class="nx">app</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="nx">newBoltConfiguration</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// boltConfiguration constructor
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">newBoltConfiguration</span><span class="p">()</span> <span class="o">*</span><span class="nx">boltConfiguration</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">boltConfiguration</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">boltConfiguration</span><span class="p">)</span> <span class="nf">BoltRepository</span><span class="p">()</span> <span class="o">*</span><span class="nx">BoltRepository</span> <span class="p">{</span>

	<span class="nx">repo</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">BoltRepository</span><span class="p">{}</span>

	<span class="c1">// config repo according to c.BoltProperties
</span><span class="c1"></span>
	<span class="k">return</span> <span class="nx">repo</span>
<span class="p">}</span></code></pre></div>
                <div class="order-0 w-20 dn db-l">
                    
<nav role="navigation">
  <ul class="list pa0 nl2">
    
      
      <li class="f5 w-100 hover-bg-light-gray hover-accent-color-light fw8">
        <a href="javascript:void(0)" class="js-toggle dib w-100 link mid-gray hover-accent-color-light pl2 pr2 pv2  primary-color" data-target=".Hiboot云原生应用框架">Hiboot云原生应用框架</a>
        <ul class="Hiboot云原生应用框架 desktopmenu animated fadeIn list pl0 bg-light-gray db">
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/getting-started/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              入门
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/cli-app/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              命令行应用
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/web-app/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 black ">
              网络应用
            </a>
          </li>
          <li class="f6 fw4">
            <a href="https://hiboot.hidevops.io/cn/auto-configure/" class="db link hover-bg-gray hover-white pl3 pr2 pv2 primary-color ">
              自动配置
            </a>
          </li>
        </ul>
      </li>
  </ul>
</nav>

                </div>
                <aside class="copyright" role="note">
                     &copy; 2019 Released under the Apache 2.0 license &ndash;  - By John Deng.
                </aside>
            </div>

            <footer class="footer">
                

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://hiboot.hidevops.io/cn/search/" title="搜索结果">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              搜索结果
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://hiboot.hidevops.io/cn/inversion-of-control/" title="控制反转">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              控制反转
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





            </footer>
        </div>
    </article>
    <div class="sticky">
	
	
	
	
		
		
		
	
		
		<div class="col-md-2 pl-0">
			
			<div id="page-scrollspy" class="toc-nav">
				
				<ul class="nav nav-pills ml-0">
					
					<li class="nav-item pb-3 text-center">
						<span class="font-weight-bold mb-2">- What's on this Page - </span>
					</li>
					
						
						
							
								
								
									<ul class="nav">
								
								
										<li class="nav-item">
						 					<a class="nav-link" href="#%e8%87%aa%e5%8a%a8%e9%85%8d%e7%bd%ae-starter">
												 自动配置 Starter
											</a>
										</li>
						 
								
								
									</ul>
								
							
						
				 
						
						
							
								
								
									<ul class="nav">
								
								
										<li class="nav-item">
						 					<a class="nav-link" href="#%e5%88%9b%e5%bb%ba%e4%bd%a0%e8%87%aa%e5%b7%b1%e7%9a%84-starter">
												 创建你自己的 Starter
											</a>
										</li>
						 
								
								
									</ul>
								
							
						
				 
						
						
							
								
								
									<ul class="nav">
								
								
										<li class="nav-item">
						 					<a class="nav-link" href="#%e4%bb%a3%e7%a0%81%e7%a4%ba%e4%be%8b">
												 代码示例
											</a>
										</li>
						 
								
								
									</ul>
								
							
						
				 
				</ul>
			</div>
			
		</div>
		
	</div>
    <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
            <div class="wrapper">
                <div class="meta"></div>
                <div class="list"></div>
            </div>
        </div>
    </div>
</main>

    <script>
    
      var base_url = 'https:\/\/hiboot.hidevops.io\/';
      var repo_id  = '\/';
    
    </script>

    <script src="https://hiboot.hidevops.io/javascripts/application.js"></script>
    <script src="https://hiboot.hidevops.io/javascripts/menutoggle.js"></script>
    <script src="https://hiboot.hidevops.io/javascripts/bootstrap.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = " ";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
